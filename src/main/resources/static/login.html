<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SmartSpend â€” Login</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body class="auth-body">

  <div class="auth-container">
    <h1 class="auth-title">Welcome Back</h1>

    <form id="loginForm">
      <div class="auth-field">
        <label>Email</label>
        <input type="email" id="loginEmail" placeholder="you@example.com" required>
      </div>

      <div class="auth-field">
        <label>Password</label>
        <input type="password" id="loginPassword" placeholder="Your password" required>
      </div>

      <button id="loginBtn" class="auth-button" type="submit">Sign In</button>

      <div id="loginMessage" class="auth-message"></div>

      <p class="auth-footer">
        Need an account?
        <a href="register.html">Register</a>
      </p>
    </form>
  </div>

  <!-- ðŸ”¥ IMPORTANT: iska script tag hataana nahi hai -->
  <script>
    const API_BASE_URL = "https://smartspend-production-d76a.up.railway.app";

    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("loginForm");
      const msg  = document.getElementById("loginMessage");
      const btn  = document.getElementById("loginBtn");

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        msg.textContent = "";
        msg.className = "auth-message";
        btn.disabled = true;

        const payload = {
          email: document.getElementById("loginEmail").value,
          password: document.getElementById("loginPassword").value
        };

        try {
          const response = await fetch(API_BASE_URL + "/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });

          const raw = await response.text();
          const trimmed = (raw || "").trim();

          // âŒ Agar response OK hi nahi hai -> direct fail
          if (!response.ok) {
            msg.textContent = "Login failed: " + (trimmed || "Invalid email or password");
            msg.className = "auth-message error";
            localStorage.removeItem("token");
            btn.disabled = false;
            return;
          }

          // âœ… Backend ne token diya to use karo, warna hum khud bana lenge
          let token = trimmed;
          if (!token) {
            token = "sess-" + Date.now();   // frontend generated session id
          }

          localStorage.setItem("token", token);
          localStorage.setItem("userEmail", payload.email);

          msg.textContent = "Login successful! Redirecting...";
          msg.className = "auth-message success";

          setTimeout(() => {
            window.location.href = "dashboard.html";
          }, 800);

        } catch (err) {
          console.error(err);
          msg.textContent = "Network error!";
          msg.className = "auth-message error";
        } finally {
          btn.disabled = false;
        }
      });
    });
  </script>

</body>
</html>
